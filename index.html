<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì‹¤ì‹œê°„ ìë§‰</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;700;900&family=Space+Mono&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --border: #1f1f2e;
    --accent: #5b6af0;
    --accent2: #9f7aea;
    --text: #f0f0ff;
    --muted: #4a4a6a;
    --green: #38ef7d;
    --red: #ff4d6d;
    --glow: rgba(91, 106, 240, 0.35);
  }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
  }

  /* â”€â”€ ë°°ê²½ ê·¸ë ˆì¸ + ê·¸ë¼ë””ì–¸íŠ¸ â”€â”€ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 20% 10%, rgba(91,106,240,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 60% 50% at 80% 90%, rgba(159,122,234,0.10) 0%, transparent 55%);
    pointer-events: none;
    z-index: 0;
  }

  /* â”€â”€ ë ˆì´ì•„ì›ƒ â”€â”€ */
  .app {
    position: relative;
    z-index: 1;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    padding: 16px;
    gap: 12px;
  }

  /* â”€â”€ í—¤ë” â”€â”€ */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 4px;
  }

  .brand {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    letter-spacing: 0.08em;
    color: var(--accent);
  }
  .brand-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 8px var(--accent);
    animation: breathe 2s ease-in-out infinite;
  }
  @keyframes breathe {
    0%,100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.7); }
  }

  /* ì–¸ì–´ ì„ íƒ */
  .lang-select {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 8px;
    outline: none;
    cursor: pointer;
    -webkit-appearance: none;
  }

  /* â”€â”€ ìë§‰ ë©”ì¸ íŒ¨ë„ â”€â”€ */
  .subtitle-panel {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 28px 24px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow: hidden;
    position: relative;
  }

  /* ì¸ì‹ ì¤‘ í…Œë‘ë¦¬ íš¨ê³¼ */
  .subtitle-panel.active {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent), 0 0 30px var(--glow);
  }
  .subtitle-panel.active::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 20px;
    background: radial-gradient(ellipse 70% 40% at 50% 0%, rgba(91,106,240,0.07) 0%, transparent 70%);
    pointer-events: none;
  }

  /* ì„ì‹œ í…ìŠ¤íŠ¸ (ì¸ì‹ ì¤‘) */
  .interim-text {
    font-size: clamp(15px, 4vw, 18px);
    font-weight: 300;
    color: var(--muted);
    line-height: 1.6;
    min-height: 28px;
    letter-spacing: 0.02em;
    transition: color 0.3s;
    font-style: italic;
  }

  /* í™•ì • ìë§‰ */
  .final-text {
    font-size: clamp(22px, 6vw, 34px);
    font-weight: 700;
    color: var(--text);
    line-height: 1.4;
    letter-spacing: -0.01em;
    word-break: break-word;
    overflow-y: auto;
    flex: 1;
  }

  /* ìµœì‹  ë¬¸ì¥ í•˜ì´ë¼ì´íŠ¸ */
  .final-text .latest {
    color: #ffffff;
    text-shadow: 0 0 20px rgba(91,106,240,0.6);
  }
  .final-text .old {
    color: var(--muted);
  }

  /* ë¹ˆ ìƒíƒœ */
  .empty-hint {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: var(--muted);
    font-size: 14px;
    font-weight: 300;
    line-height: 1.8;
    pointer-events: none;
    transition: opacity 0.4s;
  }
  .empty-hint.hidden { opacity: 0; }
  .empty-icon { font-size: 40px; margin-bottom: 10px; display: block; }

  /* â”€â”€ íŒŒí˜• ì‹œê°í™” â”€â”€ */
  .wave-container {
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3px;
    padding: 0 4px;
  }
  .wave-bar {
    width: 3px;
    border-radius: 2px;
    background: var(--accent);
    height: 4px;
    transition: height 0.1s ease;
    opacity: 0.6;
  }
  .listening .wave-bar {
    animation: wave-idle 1.4s ease-in-out infinite;
    opacity: 1;
  }
  @keyframes wave-idle {
    0%,100% { height: 4px; }
    50% { height: 20px; }
  }
  .wave-bar:nth-child(2) { animation-delay: 0.1s; }
  .wave-bar:nth-child(3) { animation-delay: 0.2s; }
  .wave-bar:nth-child(4) { animation-delay: 0.3s; }
  .wave-bar:nth-child(5) { animation-delay: 0.2s; }
  .wave-bar:nth-child(6) { animation-delay: 0.1s; }

  /* â”€â”€ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì˜ì—­ â”€â”€ */
  .controls {
    display: flex;
    gap: 10px;
  }

  .btn-main {
    flex: 1;
    height: 64px;
    border-radius: 16px;
    border: none;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: transform 0.12s, box-shadow 0.2s, background 0.3s;
    outline: none;
    -webkit-appearance: none;
    letter-spacing: 0.04em;
  }

  .btn-main:active { transform: scale(0.96); }

  .btn-start {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: #fff;
    box-shadow: 0 4px 24px rgba(91,106,240,0.5);
  }
  .btn-stop {
    background: linear-gradient(135deg, #ff4d6d, #ff7849);
    color: #fff;
    box-shadow: 0 4px 24px rgba(255,77,109,0.4);
  }

  .btn-clear {
    width: 64px;
    height: 64px;
    border-radius: 16px;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--muted);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.12s, border-color 0.2s, color 0.2s;
    outline: none;
  }
  .btn-clear:active { transform: scale(0.94); }
  .btn-clear:hover { border-color: var(--red); color: var(--red); }

  /* â”€â”€ ìƒíƒœ ë°” â”€â”€ */
  .status-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 0.05em;
    padding-bottom: env(safe-area-inset-bottom, 4px);
  }
  .status-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
  }
  .status-dot.on { background: var(--green); box-shadow: 0 0 6px var(--green); }
  .status-dot.err { background: var(--red); }

  /* â”€â”€ ì—ëŸ¬ í† ìŠ¤íŠ¸ â”€â”€ */
  .toast {
    position: fixed;
    bottom: 120px; left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: #2a1020;
    border: 1px solid var(--red);
    color: #ffa0b4;
    padding: 12px 20px;
    border-radius: 12px;
    font-size: 13px;
    opacity: 0;
    transition: opacity 0.3s, transform 0.3s;
    pointer-events: none;
    z-index: 99;
    white-space: nowrap;
    max-width: 90vw;
    white-space: normal;
    text-align: center;
  }
  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
  .final-text::-webkit-scrollbar { display: none; }
  .final-text { -ms-overflow-style: none; scrollbar-width: none; }
</style>
</head>
<body>

<div class="app">
  <!-- í—¤ë” -->
  <header>
    <div class="brand">
      <div class="brand-dot"></div>
      LIVE SUBTITLE
    </div>
    <select class="lang-select" id="langSelect">
      <option value="ko-KR">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
      <option value="en-US">ğŸ‡ºğŸ‡¸ English</option>
      <option value="ja-JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
      <option value="zh-CN">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
      <option value="fr-FR">ğŸ‡«ğŸ‡· FranÃ§ais</option>
      <option value="es-ES">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
      <option value="de-DE">ğŸ‡©ğŸ‡ª Deutsch</option>
    </select>
  </header>

  <!-- ìë§‰ íŒ¨ë„ -->
  <div class="subtitle-panel" id="panel">
    <div class="empty-hint" id="emptyHint">
      <span class="empty-icon">ğŸ™ï¸</span>
      ë²„íŠ¼ì„ ëˆŒëŸ¬<br>ìŒì„± ì¸ì‹ì„ ì‹œì‘í•˜ì„¸ìš”
    </div>
    <div class="final-text" id="finalText"></div>
    <div class="interim-text" id="interimText"></div>
  </div>

  <!-- íŒŒí˜• -->
  <div class="wave-container" id="waveContainer">
    <div class="wave-bar"></div>
    <div class="wave-bar"></div>
    <div class="wave-bar"></div>
    <div class="wave-bar"></div>
    <div class="wave-bar"></div>
    <div class="wave-bar"></div>
    <div class="wave-bar"></div>
  </div>

  <!-- ì»¨íŠ¸ë¡¤ -->
  <div class="controls">
    <button class="btn-main btn-start" id="mainBtn" onclick="toggleListen()">
      <span>â–¶</span> ì‹œì‘
    </button>
    <button class="btn-clear" id="clearBtn" onclick="clearText()" title="ì§€ìš°ê¸°">ğŸ—‘</button>
  </div>

  <!-- ìƒíƒœ -->
  <div class="status-bar">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">ëŒ€ê¸° ì¤‘</span>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let recognition = null;
let isListening = false;
let sentences = [];            // í™•ì •ëœ ë¬¸ì¥ë“¤
const MAX_SENTENCES = 6;       // ìµœëŒ€ í‘œì‹œ ë¬¸ì¥ ìˆ˜

const panel = document.getElementById('panel');
const finalDiv = document.getElementById('finalText');
const interimDiv = document.getElementById('interimText');
const emptyHint = document.getElementById('emptyHint');
const mainBtn = document.getElementById('mainBtn');
const statusDot = document.getElementById('statusDot');
const statusText = document.getElementById('statusText');
const waveContainer = document.getElementById('waveContainer');
const langSelect = document.getElementById('langSelect');

// â”€â”€ Web Speech API ì§€ì› í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  showToast('âš ï¸ ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nChrome(Android) ë˜ëŠ” Safari(iOS)ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.', 6000);
  mainBtn.disabled = true;
  mainBtn.style.opacity = '0.4';
}

// â”€â”€ ì¸ì‹ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initRecognition() {
  recognition = new SpeechRecognition();
  recognition.lang = langSelect.value;
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.maxAlternatives = 1;

  recognition.onstart = () => {
    setListeningUI(true);
  };

  recognition.onresult = (e) => {
    let interim = '';
    for (let i = e.resultIndex; i < e.results.length; i++) {
      const t = e.results[i][0].transcript;
      if (e.results[i].isFinal) {
        addSentence(t.trim());
        interim = '';
      } else {
        interim += t;
      }
    }
    interimDiv.textContent = interim;
    animateWave(interim.length > 0);
  };

  recognition.onerror = (e) => {
    const msgs = {
      'not-allowed': 'ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ë¥¼ í—ˆìš©í•´ì£¼ì„¸ìš”.',
      'no-speech': null,   // ì¡°ìš©íˆ ë¬´ì‹œ
      'network': 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
      'aborted': null,
    };
    const msg = msgs[e.error];
    if (msg) {
      showToast('âŒ ' + msg);
      stopListening();
    }
  };

  recognition.onend = () => {
    interimDiv.textContent = '';
    if (isListening) {
      // ìë™ ì¬ì‹œì‘ (continuousê°€ ëŠê¸°ëŠ” ê²½ìš° ëŒ€ë¹„)
      try { recognition.start(); } catch(err) {}
    } else {
      setListeningUI(false);
    }
  };
}

// â”€â”€ ì‹œì‘ / ì¤‘ì§€ í† ê¸€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleListen() {
  if (isListening) {
    stopListening();
  } else {
    startListening();
  }
}

function startListening() {
  if (!SpeechRecognition) return;
  isListening = true;
  initRecognition();
  try {
    recognition.start();
  } catch(e) {
    showToast('ë§ˆì´í¬ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + e.message);
    isListening = false;
  }
}

function stopListening() {
  isListening = false;
  if (recognition) {
    recognition.abort();
    recognition = null;
  }
  setListeningUI(false);
  animateWave(false);
}

// â”€â”€ UI ìƒíƒœ ì—…ë°ì´íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setListeningUI(on) {
  if (on) {
    mainBtn.innerHTML = '<span>â¹</span> ì¤‘ì§€';
    mainBtn.className = 'btn-main btn-stop';
    panel.classList.add('active');
    waveContainer.classList.add('listening');
    statusDot.className = 'status-dot on';
    statusText.textContent = 'ì¸ì‹ ì¤‘ Â· ' + langSelect.value;
  } else {
    mainBtn.innerHTML = '<span>â–¶</span> ì‹œì‘';
    mainBtn.className = 'btn-main btn-start';
    panel.classList.remove('active');
    waveContainer.classList.remove('listening');
    statusDot.className = 'status-dot';
    statusText.textContent = 'ëŒ€ê¸° ì¤‘';
  }
}

// â”€â”€ ìë§‰ ì¶”ê°€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addSentence(text) {
  if (!text) return;
  sentences.push(text);
  if (sentences.length > MAX_SENTENCES) sentences.shift();
  renderSentences();
  emptyHint.classList.add('hidden');
  // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
  requestAnimationFrame(() => {
    finalDiv.scrollTop = finalDiv.scrollHeight;
  });
}

function renderSentences() {
  finalDiv.innerHTML = '';
  sentences.forEach((s, i) => {
    const span = document.createElement('span');
    const isLatest = (i === sentences.length - 1);
    span.className = isLatest ? 'latest' : 'old';
    span.textContent = s + ' ';
    finalDiv.appendChild(span);
  });
}

function clearText() {
  sentences = [];
  finalDiv.innerHTML = '';
  interimDiv.textContent = '';
  emptyHint.classList.remove('hidden');
}

// â”€â”€ íŒŒí˜• ì• ë‹ˆë©”ì´ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animateWave(active) {
  const bars = waveContainer.querySelectorAll('.wave-bar');
  if (active) {
    bars.forEach(b => {
      const h = 8 + Math.random() * 32;
      b.style.height = h + 'px';
    });
  }
}

// ì¸ì‹ ì¤‘ íŒŒí˜• ëœë¤ ì—…ë°ì´íŠ¸
setInterval(() => {
  if (isListening) animateWave(true);
}, 120);

// â”€â”€ ì–¸ì–´ ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
langSelect.addEventListener('change', () => {
  if (isListening) {
    stopListening();
    setTimeout(startListening, 200);
  }
});

// â”€â”€ í† ìŠ¤íŠ¸ ì•Œë¦¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg, duration = 4000) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), duration);
}

// â”€â”€ í™”ë©´ êº¼ì§ ë°©ì§€ (WakeLock API) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function requestWakeLock() {
  try {
    if ('wakeLock' in navigator) {
      await navigator.wakeLock.request('screen');
    }
  } catch(e) {}
}
requestWakeLock();
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') requestWakeLock();
});
</script>
</body>
</html>
